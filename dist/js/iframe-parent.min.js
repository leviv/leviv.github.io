"use strict";function handleCmeIframeMessage(e){var t,a,r,n,i,s,o;if(t=window.location.href,!/https?:\/\/(?:dev|localhost:3000|tree\.mediaengagement\.org|enptree(\.staging)?\.wpengine\.com)\b/.test(e.origin))return console.error("Domain not allowed.",e.origin),!1;if("string"!=typeof e.data)return console.error("Data is not a string."),!1;if(r=JSON.parse(e.data),n="cme-tree__"+r.tree_id,i=document.getElementById(n),a={iframe:i,parentURL:t,treeID:r.tree_id},0===cmeTreeIframes.length)cmeTreeIframes.push(new CmeIframeTree(a)),s=cmeTreeIframes[0];else{o=!1;for(var m=0;m<cmeTreeIframes.length;m++)cmeTreeIframes[m].iframeID===i.id&&(s=cmeTreeIframes[m],o=!0);!1===o&&(cmeTreeIframes.push(new CmeIframeTree(a)),s=cmeTreeIframes[cmeTreeIframes.length-1])}s.receiveIframeMessage(e.origin,r)}function CmeIframeTree(e){this.iframe=e.iframe,this.iframeID=e.iframe.id,this.treeID=e.treeID,this.onLoadIframe()}var cmeTreeIframes=[];window.addEventListener("message",handleCmeIframeMessage,!1),document.onreadystatechange=function(){var e=void 0,t=void 0;if("complete"===document.readyState){e=document.getElementsByClassName("cme-tree__iframe");for(var a=0;a<e.length;++a)t='{"status":"request","action":"init"}',console.log("sending init",t),e[a].contentWindow.postMessage(t,e[a].src)}},CmeIframeTree.prototype={constructor:CmeIframeTree,getSiteName:function(){var e=this.getFBSiteNameMeta();return e=e?"":document.title},getFBSiteNameMeta:function(){var e=document.querySelector('meta[property="og:site_name"]');return!!e&&e.content},receiveIframeMessage:function(e,t){var a;return a={},console.log("parent recieved message",t),"treeHeight"===t.action?a.setTreeHeight=this.setTreeHeight(t.treeHeight):"update"===t.action&&"forceCurrentState"!==t.data.updatedBy?a.scrollToQuizResponse=this.scrollToQuiz():"getParentSiteName"===t.action?this.sendSiteName():"getParentPath"===t.action?this.sendPath():"getParentHost"===t.action&&this.sendHost(),a},onLoadIframe:function(){this.addIframeStyles(),this.getQuizHeight(),this.sendHost(),this.sendPath()},getQuizHeight:function(){var e;e='{"status":"request","action":"sendBodyHeight"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},sendSiteName:function(){var e;e='{"action":"setParentSiteName","siteName":"'+this.getSiteName()+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},sendPath:function(){var e;e='{"action":"setParentPath","path":"'+window.self.location.pathname+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},sendHost:function(){var e;e='{"action":"setParentHost","host":"'+window.self.location.host+'"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},setTreeHeight:function(e){return console.log(e),this.iframe.style.height=e+"px",e},scrollToQuiz:function(){var e=!1,t=this.iframe.getBoundingClientRect().top;return-20<t&&t<100?e="noScroll":(scrollBy(0,t-10),e="scrolledTop"),e},addIframeStyles:function(){var e=".cme-tree__iframe { -webkit-transition: all .3s ease-in-out;transition: all .3s ease-in-out; }",t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e)),t.appendChild(a)}};